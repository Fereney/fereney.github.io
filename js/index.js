(()=>{var k={position:{bottom:20,left:4},fontSize:14,color:"#2a1f29"},Y={color:"#2a1f29"},K=(_,d,n)=>{for(let i=0;i<=d;i++){let t=document.createElement("div");t.className="map__gridLine",t.style.left="0",t.style.top=`${i*n}px`,t.style.width=`${d*n}px`,t.style.height="1px",t.style.backgroundColor=Y.color,_.appendChild(t)}for(let i=0;i<=d;i++){let t=document.createElement("div");t.className="map__gridLine",t.style.left=`${i*n}px`,t.style.top="0",t.style.width="1px",t.style.height=`${d*n}px`,t.style.backgroundColor=Y.color,_.appendChild(t)}for(let i=0;i<d;i++)for(let t=0;t<d;t++){let r=document.createElement("div");r.className="map__gridLabel";let g=String.fromCharCode(65+(d-1-i)),p=(t+1).toString();r.textContent=`${g}${p}`,r.style.position="absolute",r.style.left=`${t*n+k.position.left}px`,r.style.top=`${(i+1)*n-k.position.bottom}px`,r.style.fontSize=`${k.fontSize}`,r.style.color=`${k.color}`,r.style.pointerEvents="none",_.appendChild(r)}},D=K;var F=(_,d,n,i,t,r)=>{let g=_.getBoundingClientRect(),p=d-g.left,f=n-g.top,y=(p-i)/r,c=(f-t)/r;return{x:y,y:c}},L=F;var G=(_,d,n,i)=>{_.style.transform=`translate(${d}px, ${n}px) scale(${i})`},E=G;var J=_=>{switch(_){case"Cave":return'<img src="./images/icons/common/Cave.svg" alt="Cave" width="40" height="40"/>';case"HomeBase":return'<img src="./images/icons/common/HomeBase.svg" alt="HomeBase" width="40" height="40"/>';case"Proxy":return'<img src="./images/icons/common/Proxy.svg" alt="Proxy" width="40" height="40"/>';case"Shipwreck":return'<img src="./images/icons/common/Shipwreck.svg" alt="Shipwreck" width="40" height="40"/>';case"ShipwreckX2":return'<img src="./images/icons/common/ShipwreckX2.svg" alt="ShipwreckX2" width="40" height="40"/>';case"Spice1":return'<img src="./images/icons/common/Spice1.svg" alt="Spice1" width="40" height="40"/>';case"Spice2":return'<img src="./images/icons/common/Spice2.svg" alt="Spice2" width="40" height="40"/>';case"Spice3":return'<img src="./images/icons/common/Spice3.svg" alt="Spice3" width="40" height="40"/>';case"Stravidium":return'<img src="./images/icons/common/Stravidium.svg" alt="Stravidium" width="40" height="40"/>';case"TestingStation":return'<img src="./images/icons/common/TestingStation.svg" alt="TestingStation" width="40" height="40"/>';case"Titanium":return'<img src="./images/icons/common/Titanium.svg" alt="Titanium" width="40" height="40"/>';case"House_Alexin":return'<img src="./images/icons/houses/House_Alexin.svg" alt="House_Alexin" width="40" height="40"/>';case"House_Argpsaz":return'<img src="./images/icons/houses/House_Argpsaz.svg" alt="House_Argpsaz" width="40" height="40"/>';case"House_Dyvetz":return'<img src="./images/icons/houses/House_Dyvetz.svg" alt="House_Dyvetz" width="40" height="40"/>';case"House_Ecaz":return'<img src="./images/icons/houses/House_Ecaz.svg" alt="House_Ecaz" width="40" height="40"/>';case"House_Hagal":return'<img src="./images/icons/houses/House_Hagal.svg" alt="House_Hagal" width="40" height="40"/>';case"House_Hurata":return'<img src="./images/icons/houses/House_Hurata.svg" alt="House_Hurata" width="40" height="40"/>';case"House_Imota":return'<img src="./images/icons/houses/House_Imota.svg" alt="House_Imota" width="40" height="40"/>';case"House_Kenola":return'<img src="./images/icons/houses/House_Kenola.svg" alt="House_Kenola" width="40" height="40"/>';case"House_Lindaren":return'<img src="./images/icons/houses/House_Lindaren.svg" alt="House_Lindaren" width="40" height="40"/>';case"House_Maros":return'<img src="./images/icons/houses/House_Maros.svg" alt="House_Maros" width="40" height="40"/>';case"House_Mikarrol":return'<img src="./images/icons/houses/House_Mikarrol.svg" alt="House_Mikarrol" width="40" height="40"/>';case"House_Moritani":return'<img src="./images/icons/houses/House_Moritani.svg" alt="House_Moritani" width="40" height="40"/>';case"House_Mutelli":return'<img src="./images/icons/houses/House_Mutelli.svg" alt="House_Mutelli" width="40" height="40"/>';case"House_Novebruns":return'<img src="./images/icons/houses/House_Novebruns.svg" alt="House_Novebruns" width="40" height="40"/>';case"House_Richese":return'<img src="./images/icons/houses/House_Richese.svg" alt="House_Richese" width="40" height="40"/>';case"House_Sor":return'<img src="./images/icons/houses/House_Sor.svg" alt="House_Sor" width="40" height="40"/>';case"House_Spinnette":return'<img src="./images/icons/houses/House_Spinnette.svg" alt="House_Spinnette" width="40" height="40"/>';case"House_Taligari":return'<img src="./images/icons/houses/House_Taligari.svg" alt="House_Taligari" width="40" height="40"/>';case"House_Thorvald":return'<img src="./images/icons/houses/House_Thorvald.svg" alt="House_Thorvald" width="40" height="40"/>';case"House_Tseida":return'<img src="./images/icons/houses/House_Tseida.svg" alt="House_Tseida" width="40" height="40"/>';case"House_Varota":return'<img src="./images/icons/houses/House_Varota.svg" alt="House_Varota" width="40" height="40"/>';case"House_Vernius":return'<img src="./images/icons/houses/House_Vernius.svg" alt="House_Vernius" width="40" height="40"/>';case"House_Wallach":return'<img src="./images/icons/houses/House_Wallach.svg" alt="House_Wallach" width="40" height="40"/>';case"House_Wayku":return'<img src="./images/icons/houses/House_Wayku.svg" alt="House_Wayku" width="40" height="40"/>';case"House_Wydras":return'<img src="./images/icons/houses/House_Wydras.svg" alt="House_Wydras" width="40" height="40"/>';default:return null}},N=J;var j=()=>{let n=1,i=0,t=0,r=!1,g,p,f=[],y=1,c={MAP_MOVE:"map_move",MAP_EDIT:"map_edit",MAP_ICON:"map_icon",MAP_DELETE:"map_delete"},h=c.MAP_MOVE,P="pin",l=document.querySelector(".map__container"),m=document.querySelector(".map__canvas"),C=document.querySelector(".map__mode_move"),A=document.querySelector(".map__mode_edit"),b=document.querySelector(".map__mode_delete"),T=document.querySelector(".map__mode_icon"),B=document.querySelector(".map__shareLink"),O=document.querySelector(".map__shareField"),S=document.querySelector(".map__modeStatus"),V=document.querySelector(".map__controlsPart_icons"),I=document.querySelectorAll(".map__iconPicker"),$=e=>{V&&(V.style.display=e?"flex":"none")},z=e=>{e.forEach(o=>{o.classList.remove("map__button_active")}),$(!1)},x=e=>{l.classList.remove("map__container_grab"),l.classList.remove("map__container_crosshair"),l.classList.remove("map__container_pointer"),l.classList.add(`map__container_${e}`)},w=e=>{switch(h=e,z([C,A,b,T]),$(!1),e){case c.MAP_MOVE:C.classList.add("map__button_active"),S.textContent="\u041F\u0435\u0440\u0435\u043C\u0435\u0449\u0430\u0439\u0442\u0435 \u043A\u0430\u0440\u0442\u0443",x("grab");break;case c.MAP_EDIT:A.classList.add("map__button_active"),S.textContent="\u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0439\u0442\u0435 \u043C\u0430\u0440\u043A\u0435\u0440\u044B",x("crosshair");break;case c.MAP_DELETE:b.classList.add("map__button_active"),S.textContent="\u0423\u0434\u0430\u043B\u044F\u0439\u0442\u0435 \u043C\u0430\u0440\u043A\u0435\u0440\u044B",x("pointer");break;case c.MAP_ICON:T.classList.add("map__button_active"),S.textContent="\u0414\u043E\u0431\u0430\u0432\u043B\u044F\u0439\u0442\u0435 \u043C\u0430\u0440\u043A\u0435\u0440\u044B-\u0438\u043A\u043E\u043D\u043A\u0438",x("crosshair"),$(!0);break}},W=()=>{l.addEventListener("mousedown",e=>{h===c.MAP_MOVE&&(e.target===l||e.target===m)&&(r=!0,g=e.clientX,p=e.clientY,l.style.cursor="grabbing")}),l.addEventListener("touchstart",e=>{h===c.MAP_MOVE&&(e.target===l||e.target===m)&&e.touches.length===1&&(r=!0,g=e.touches[0].clientX,p=e.touches[0].clientY,l.style.cursor="grabbing")}),document.addEventListener("mousemove",e=>{if(r&&h===c.MAP_MOVE){let o=e.clientX-g,s=e.clientY-p;i+=o,t+=s,g=e.clientX,p=e.clientY,E(m,i,t,n),H()}}),document.addEventListener("touchmove",e=>{if(r&&h===c.MAP_MOVE&&e.touches.length===1){let o=e.touches[0].clientX-g,s=e.touches[0].clientY-p;i+=o,t+=s,g=e.touches[0].clientX,p=e.touches[0].clientY,E(m,i,t,n),H(),e.preventDefault()}},{passive:!1}),document.addEventListener("mouseup",()=>{r=!1,h===c.MAP_MOVE&&(l.style.cursor="grab")}),document.addEventListener("touchend",()=>{r=!1,h===c.MAP_MOVE&&(l.style.cursor="grab")}),l.addEventListener("wheel",e=>{e.preventDefault();let{x:o,y:s}=L(l,e.clientX,e.clientY,i,t,n),a=e.deltaY>0?.9:1.1;n*=a,n=Math.max(.1,Math.min(n,5));let v=l.getBoundingClientRect(),u=e.clientX-v.left,M=e.clientY-v.top;i=u-o*n,t=M-s*n,E(m,i,t,n),H()}),l.addEventListener("click",e=>{if(h===c.MAP_EDIT&&e.target===m){let{x:o,y:s}=L(l,e.clientX,e.clientY,i,t,n),a=prompt("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043C\u0430\u0440\u043A\u0435\u0440\u0430:","\u041D\u043E\u0432\u044B\u0439 \u043C\u0430\u0440\u043A\u0435\u0440");a&&a.trim()!==""&&(X(o,s,a),H())}else if(h===c.MAP_ICON&&e.target===m){if(!P)return;let{x:o,y:s}=L(l,e.clientX,e.clientY,i,t,n),a=prompt("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u043C\u0430\u0440\u043A\u0435\u0440\u0430:","");a!==null&&(X(o,s,a,null,P),H())}}),m.addEventListener("click",e=>{let o=null;if(e.target.classList.contains("map__marker")?o=e.target:e.target.closest&&e.target.closest(".map__marker")&&(o=e.target.closest(".map__marker")),o){if(h===c.MAP_DELETE){let s=parseInt(o.dataset.id);confirm("\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u044D\u0442\u043E\u0442 \u043C\u0430\u0440\u043A\u0435\u0440?")&&(o.remove(),f=f.filter(a=>a.id!==s),H())}else if(h===c.MAP_MOVE){let s=prompt("\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u0435:",o.dataset.text);if(s!==null){o.dataset.text=s;let a=parseInt(o.dataset.id),v=f.find(M=>M.id===a);v&&(v.text=s);let u=o.querySelector(".map__markerTooltip");u&&(u.textContent=s,s?u.style.display="":u.style.display="none"),H()}}}}),C.addEventListener("click",()=>w(c.MAP_MOVE)),A.addEventListener("click",()=>w(c.MAP_EDIT)),b.addEventListener("click",()=>w(c.MAP_DELETE)),T.addEventListener("click",()=>w(c.MAP_ICON)),I&&I.forEach(e=>{e.addEventListener("click",()=>{P=e.dataset.icon,I.forEach(o=>{console.log(o.classList),o.classList.remove("map__iconPicker_active")}),e.classList.add("map__iconPicker_active")})}),B.addEventListener("click",()=>{H(),O.select(),document.execCommand("copy"),alert("\u0421\u0441\u044B\u043B\u043A\u0430 \u0441\u043A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u043D\u0430 \u0432 \u0431\u0443\u0444\u0435\u0440 \u043E\u0431\u043C\u0435\u043D\u0430")})},X=(e,o,s,a=null,v=null)=>{a===null&&(a=y++);let u=document.createElement("div");if(u.className="map__marker",u.dataset.id=a,u.dataset.text=s,v&&(u.className="map__marker map__marker_icon",u.dataset.icon=v,u.innerHTML=N(v)),s&&s!==""){let M=document.createElement("div");M.className="map__markerTooltip",M.textContent=s,u.appendChild(M)}return u.style.left=`${e}px`,u.style.top=`${o}px`,m.appendChild(u),f.push({id:a,x:e,y:o,text:s,icon:v||null}),u},H=()=>{let e={scale:n,offsetX:i,offsetY:t,markers:f.map(a=>({id:a.id,x:a.x,y:a.y,text:a.text,icon:a.icon||null}))},o=encodeURIComponent(JSON.stringify(e)),s=`${window.location.origin}${window.location.pathname}?state=${o}`;O.value=s,window.history.replaceState(null,null,s)},R=()=>{let o=new URLSearchParams(window.location.search).get("state");if(o)try{let s=JSON.parse(decodeURIComponent(o));n=s.scale||n,i=s.offsetX||i,t=s.offsetY||t,s.markers&&s.markers.length>0&&(f=[],s.markers.forEach(a=>{X(a.x,a.y,a.text,a.id,a.icon||null),y=Math.max(y,a.id+1)}))}catch(s){console.error("\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435 \u0441\u043E\u0441\u0442\u043E\u044F\u043D\u0438\u044F:",s)}},U=()=>{m.style.width=`${9*120}px`,m.style.height=`${9*120}px`};(()=>{U(),D(m,9,120),R(),E(m,i,t,n),W(),w(c.MAP_MOVE)})()},q=j;q();})();
//# sourceMappingURL=index.js.map
